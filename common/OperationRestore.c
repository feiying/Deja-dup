/* OperationRestore.c generated by valac 0.16.1, the Vala compiler
 * generated from OperationRestore.vala, do not modify */

/* -*- Mode: Vala; indent-tabs-mode: nil; tab-width: 2 -*- */
/*
    This file is part of Déjà Dup.
    For copyright information, see AUTHORS.

    Déjà Dup is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Déjà Dup is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Déjà Dup.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <glib.h>
#include <glib-object.h>
#include <gio/gio.h>
#include <stdlib.h>
#include <string.h>
#include <glib/gi18n-lib.h>
#include <stdio.h>


#define DEJA_DUP_TYPE_OPERATION (deja_dup_operation_get_type ())
#define DEJA_DUP_OPERATION(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), DEJA_DUP_TYPE_OPERATION, DejaDupOperation))
#define DEJA_DUP_OPERATION_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), DEJA_DUP_TYPE_OPERATION, DejaDupOperationClass))
#define DEJA_DUP_IS_OPERATION(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), DEJA_DUP_TYPE_OPERATION))
#define DEJA_DUP_IS_OPERATION_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), DEJA_DUP_TYPE_OPERATION))
#define DEJA_DUP_OPERATION_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), DEJA_DUP_TYPE_OPERATION, DejaDupOperationClass))

typedef struct _DejaDupOperation DejaDupOperation;
typedef struct _DejaDupOperationClass DejaDupOperationClass;
typedef struct _DejaDupOperationPrivate DejaDupOperationPrivate;

#define DEJA_DUP_TYPE_TOOL_JOB (deja_dup_tool_job_get_type ())
#define DEJA_DUP_TOOL_JOB(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), DEJA_DUP_TYPE_TOOL_JOB, DejaDupToolJob))
#define DEJA_DUP_TOOL_JOB_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), DEJA_DUP_TYPE_TOOL_JOB, DejaDupToolJobClass))
#define DEJA_DUP_IS_TOOL_JOB(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), DEJA_DUP_TYPE_TOOL_JOB))
#define DEJA_DUP_IS_TOOL_JOB_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), DEJA_DUP_TYPE_TOOL_JOB))
#define DEJA_DUP_TOOL_JOB_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), DEJA_DUP_TYPE_TOOL_JOB, DejaDupToolJobClass))

typedef struct _DejaDupToolJob DejaDupToolJob;
typedef struct _DejaDupToolJobClass DejaDupToolJobClass;

#define DEJA_DUP_TYPE_OPERATION_RESTORE (deja_dup_operation_restore_get_type ())
#define DEJA_DUP_OPERATION_RESTORE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), DEJA_DUP_TYPE_OPERATION_RESTORE, DejaDupOperationRestore))
#define DEJA_DUP_OPERATION_RESTORE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), DEJA_DUP_TYPE_OPERATION_RESTORE, DejaDupOperationRestoreClass))
#define DEJA_DUP_IS_OPERATION_RESTORE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), DEJA_DUP_TYPE_OPERATION_RESTORE))
#define DEJA_DUP_IS_OPERATION_RESTORE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), DEJA_DUP_TYPE_OPERATION_RESTORE))
#define DEJA_DUP_OPERATION_RESTORE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), DEJA_DUP_TYPE_OPERATION_RESTORE, DejaDupOperationRestoreClass))

typedef struct _DejaDupOperationRestore DejaDupOperationRestore;
typedef struct _DejaDupOperationRestoreClass DejaDupOperationRestoreClass;
typedef struct _DejaDupOperationRestorePrivate DejaDupOperationRestorePrivate;
#define _g_free0(var) (var = (g_free (var), NULL))
#define __g_list_free__g_object_unref0_0(var) ((var == NULL) ? NULL : (var = (_g_list_free__g_object_unref0_ (var), NULL)))

#define DEJA_DUP_TOOL_JOB_TYPE_MODE (deja_dup_tool_job_mode_get_type ())
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
typedef struct _DejaDupOperationRestoreStartData DejaDupOperationRestoreStartData;
typedef struct _Block8Data Block8Data;

#define DEJA_DUP_TYPE_SIMPLE_SETTINGS (deja_dup_simple_settings_get_type ())
#define DEJA_DUP_SIMPLE_SETTINGS(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), DEJA_DUP_TYPE_SIMPLE_SETTINGS, DejaDupSimpleSettings))
#define DEJA_DUP_SIMPLE_SETTINGS_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), DEJA_DUP_TYPE_SIMPLE_SETTINGS, DejaDupSimpleSettingsClass))
#define DEJA_DUP_IS_SIMPLE_SETTINGS(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), DEJA_DUP_TYPE_SIMPLE_SETTINGS))
#define DEJA_DUP_IS_SIMPLE_SETTINGS_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), DEJA_DUP_TYPE_SIMPLE_SETTINGS))
#define DEJA_DUP_SIMPLE_SETTINGS_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), DEJA_DUP_TYPE_SIMPLE_SETTINGS, DejaDupSimpleSettingsClass))

typedef struct _DejaDupSimpleSettings DejaDupSimpleSettings;
typedef struct _DejaDupSimpleSettingsClass DejaDupSimpleSettingsClass;
typedef struct _Block9Data Block9Data;
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))
#define _g_variant_unref0(var) ((var == NULL) ? NULL : (var = (g_variant_unref (var), NULL)))
#define __g_list_free__g_free0_0(var) ((var == NULL) ? NULL : (var = (_g_list_free__g_free0_ (var), NULL)))
#define _fclose0(var) ((var == NULL) ? NULL : (var = (fclose (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

#define DEJA_DUP_TYPE_TIMESTAMP_TYPE (deja_dup_timestamp_type_get_type ())
typedef struct _DejaDupOperationRestoreOperationFinishedData DejaDupOperationRestoreOperationFinishedData;

struct _DejaDupOperation {
	GObject parent_instance;
	DejaDupOperationPrivate * priv;
	DejaDupToolJob* job;
	gchar* passphrase;
};

struct _DejaDupOperationClass {
	GObjectClass parent_class;
	void (*start) (DejaDupOperation* self, gboolean try_claim_bus, GAsyncReadyCallback _callback_, gpointer _user_data_);
	void (*start_finish) (DejaDupOperation* self, GAsyncResult* _res_);
	void (*connect_to_job) (DejaDupOperation* self);
	void (*send_action_file_changed) (DejaDupOperation* self, GFile* file, gboolean actual);
	void (*operation_finished) (DejaDupOperation* self, DejaDupToolJob* job, gboolean success, gboolean cancelled, const gchar* detail, GAsyncReadyCallback _callback_, gpointer _user_data_);
	void (*operation_finished_finish) (DejaDupOperation* self, GAsyncResult* _res_);
	GList* (*make_argv) (DejaDupOperation* self);
};

struct _DejaDupOperationRestore {
	DejaDupOperation parent_instance;
	DejaDupOperationRestorePrivate * priv;
};

struct _DejaDupOperationRestoreClass {
	DejaDupOperationClass parent_class;
};

struct _DejaDupOperationRestorePrivate {
	gchar* _dest;
	gchar* _time;
	GList* _restore_files;
};

typedef enum  {
	DEJA_DUP_TOOL_JOB_MODE_INVALID,
	DEJA_DUP_TOOL_JOB_MODE_BACKUP,
	DEJA_DUP_TOOL_JOB_MODE_RESTORE,
	DEJA_DUP_TOOL_JOB_MODE_STATUS,
	DEJA_DUP_TOOL_JOB_MODE_LIST,
	DEJA_DUP_TOOL_JOB_MODE_HISTORY
} DejaDupToolJobMode;

struct _DejaDupOperationRestoreStartData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	DejaDupOperationRestore* self;
	gboolean try_claim_bus;
	const gchar* _tmp0_;
	gboolean _tmp1_;
};

struct _Block8Data {
	int _ref_count_;
	DejaDupOperationRestore * self;
	gchar* line;
};

struct _Block9Data {
	int _ref_count_;
	Block8Data * _data8_;
	gboolean found;
};

typedef enum  {
	DEJA_DUP_TIMESTAMP_TYPE_NONE,
	DEJA_DUP_TIMESTAMP_TYPE_BACKUP,
	DEJA_DUP_TIMESTAMP_TYPE_RESTORE
} DejaDupTimestampType;

struct _DejaDupOperationRestoreOperationFinishedData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	DejaDupOperationRestore* self;
	DejaDupToolJob* job;
	gboolean success;
	gboolean cancelled;
	gchar* detail;
	gboolean _tmp0_;
	DejaDupToolJob* _tmp1_;
	gboolean _tmp2_;
	gboolean _tmp3_;
	const gchar* _tmp4_;
};


static gpointer deja_dup_operation_restore_parent_class = NULL;

GType deja_dup_operation_get_type (void) G_GNUC_CONST;
GType deja_dup_tool_job_get_type (void) G_GNUC_CONST;
GType deja_dup_operation_restore_get_type (void) G_GNUC_CONST;
#define DEJA_DUP_OPERATION_RESTORE_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), DEJA_DUP_TYPE_OPERATION_RESTORE, DejaDupOperationRestorePrivate))
enum  {
	DEJA_DUP_OPERATION_RESTORE_DUMMY_PROPERTY,
	DEJA_DUP_OPERATION_RESTORE_DEST,
	DEJA_DUP_OPERATION_RESTORE_TIME,
	DEJA_DUP_OPERATION_RESTORE_RESTORE_FILES
};
static void _g_object_unref0_ (gpointer var);
static void _g_list_free__g_object_unref0_ (GList* self);
DejaDupOperationRestore* deja_dup_operation_restore_new (const gchar* dest_in, const gchar* time_in, GList* files_in);
DejaDupOperationRestore* deja_dup_operation_restore_construct (GType object_type, const gchar* dest_in, const gchar* time_in, GList* files_in);
GType deja_dup_tool_job_mode_get_type (void) G_GNUC_CONST;
static void deja_dup_operation_restore_real_start_data_free (gpointer _data);
static void deja_dup_operation_restore_real_start (DejaDupOperation* base, gboolean try_claim_bus, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean deja_dup_operation_restore_real_start_co (DejaDupOperationRestoreStartData* _data_);
void deja_dup_operation_start (DejaDupOperation* self, gboolean try_claim_bus, GAsyncReadyCallback _callback_, gpointer _user_data_);
void deja_dup_operation_start_finish (DejaDupOperation* self, GAsyncResult* _res_);
static void deja_dup_operation_restore_start_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static GList* deja_dup_operation_restore_real_make_argv (DejaDupOperation* base);
GList* deja_dup_operation_restore_get_restore_files (DejaDupOperationRestore* self);
void deja_dup_tool_job_set_restore_files (DejaDupToolJob* self, GList* value);
const gchar* deja_dup_operation_restore_get_time (DejaDupOperationRestore* self);
void deja_dup_tool_job_set_time (DejaDupToolJob* self, const gchar* value);
const gchar* deja_dup_operation_restore_get_dest (DejaDupOperationRestore* self);
void deja_dup_tool_job_set_local (DejaDupToolJob* self, GFile* value);
void deja_dup_operation_restore_restore_gsettings (DejaDupOperationRestore* self);
static Block8Data* block8_data_ref (Block8Data* _data8_);
static void block8_data_unref (void * _userdata_);
GType deja_dup_simple_settings_get_type (void) G_GNUC_CONST;
DejaDupSimpleSettings* deja_dup_get_settings (const gchar* subdir);
#define DEJA_DUP_APPS_ROOT "Apps"
#define DEJA_DUP_BACKUP_KEY "backup"
static Block9Data* block9_data_ref (Block9Data* _data9_);
static void block9_data_unref (void * _userdata_);
static void _____lambda31_ (Block9Data* _data9_, const gchar* entry);
static void ______lambda31__gfunc (gconstpointer data, gpointer self);
DejaDupSimpleSettings* deja_dup_get_app_settings (const gchar* ske, const gchar* subdir);
static void _g_free0_ (gpointer var);
static void _g_list_free__g_free0_ (GList* self);
static void deja_dup_operation_restore_real_operation_finished_data_free (gpointer _data);
static void deja_dup_operation_restore_real_operation_finished (DejaDupOperation* base, DejaDupToolJob* job, gboolean success, gboolean cancelled, const gchar* detail, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean deja_dup_operation_restore_real_operation_finished_co (DejaDupOperationRestoreOperationFinishedData* _data_);
GType deja_dup_timestamp_type_get_type (void) G_GNUC_CONST;
void deja_dup_update_last_run_timestamp (DejaDupTimestampType type);
void deja_dup_operation_operation_finished (DejaDupOperation* self, DejaDupToolJob* job, gboolean success, gboolean cancelled, const gchar* detail, GAsyncReadyCallback _callback_, gpointer _user_data_);
void deja_dup_operation_operation_finished_finish (DejaDupOperation* self, GAsyncResult* _res_);
static void deja_dup_operation_restore_operation_finished_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void deja_dup_operation_restore_set_dest (DejaDupOperationRestore* self, const gchar* value);
static void deja_dup_operation_restore_set_time (DejaDupOperationRestore* self, const gchar* value);
static void deja_dup_operation_restore_set_restore_files (DejaDupOperationRestore* self, GList* value);
static void deja_dup_operation_restore_finalize (GObject* obj);
static void _vala_deja_dup_operation_restore_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec);
static void _vala_deja_dup_operation_restore_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);
static gint _vala_array_length (gpointer array);


static void _g_object_unref0_ (gpointer var) {
	(var == NULL) ? NULL : (var = (g_object_unref (var), NULL));
}


static void _g_list_free__g_object_unref0_ (GList* self) {
	g_list_foreach (self, (GFunc) _g_object_unref0_, NULL);
	g_list_free (self);
}


DejaDupOperationRestore* deja_dup_operation_restore_construct (GType object_type, const gchar* dest_in, const gchar* time_in, GList* files_in) {
	DejaDupOperationRestore * self = NULL;
	const gchar* _tmp0_;
	const gchar* _tmp1_;
	GList* _tmp2_;
	g_return_val_if_fail (dest_in != NULL, NULL);
	_tmp0_ = dest_in;
	_tmp1_ = time_in;
	_tmp2_ = files_in;
	self = (DejaDupOperationRestore*) g_object_new (object_type, "dest", _tmp0_, "time", _tmp1_, "restore-files", _tmp2_, "mode", DEJA_DUP_TOOL_JOB_MODE_RESTORE, NULL);
	return self;
}


DejaDupOperationRestore* deja_dup_operation_restore_new (const gchar* dest_in, const gchar* time_in, GList* files_in) {
	return deja_dup_operation_restore_construct (DEJA_DUP_TYPE_OPERATION_RESTORE, dest_in, time_in, files_in);
}


static void deja_dup_operation_restore_real_start_data_free (gpointer _data) {
	DejaDupOperationRestoreStartData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (DejaDupOperationRestoreStartData, _data_);
}


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void deja_dup_operation_restore_real_start (DejaDupOperation* base, gboolean try_claim_bus, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	DejaDupOperationRestore * self;
	DejaDupOperationRestoreStartData* _data_;
	DejaDupOperationRestore* _tmp0_;
	gboolean _tmp1_;
	self = (DejaDupOperationRestore*) base;
	_data_ = g_slice_new0 (DejaDupOperationRestoreStartData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, deja_dup_operation_restore_real_start);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, deja_dup_operation_restore_real_start_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = try_claim_bus;
	_data_->try_claim_bus = _tmp1_;
	deja_dup_operation_restore_real_start_co (_data_);
}


static void deja_dup_operation_restore_real_start_finish (DejaDupOperation* base, GAsyncResult* _res_) {
	DejaDupOperationRestoreStartData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void deja_dup_operation_restore_start_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	DejaDupOperationRestoreStartData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	deja_dup_operation_restore_real_start_co (_data_);
}


static gboolean deja_dup_operation_restore_real_start_co (DejaDupOperationRestoreStartData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = NULL;
	_data_->_tmp0_ = _ ("Restoring files…");
	g_signal_emit_by_name ((DejaDupOperation*) _data_->self, "action-desc-changed", _data_->_tmp0_);
	_data_->_tmp1_ = _data_->try_claim_bus;
	_data_->_state_ = 1;
	DEJA_DUP_OPERATION_CLASS (deja_dup_operation_restore_parent_class)->start (DEJA_DUP_OPERATION (_data_->self), _data_->_tmp1_, deja_dup_operation_restore_start_ready, _data_);
	return FALSE;
	_state_1:
	DEJA_DUP_OPERATION_CLASS (deja_dup_operation_restore_parent_class)->start_finish (DEJA_DUP_OPERATION (_data_->self), _data_->_res_);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static GList* deja_dup_operation_restore_real_make_argv (DejaDupOperation* base) {
	DejaDupOperationRestore * self;
	GList* result = NULL;
	DejaDupToolJob* _tmp0_;
	GList* _tmp1_;
	GList* _tmp2_;
	DejaDupToolJob* _tmp3_;
	const gchar* _tmp4_;
	DejaDupToolJob* _tmp5_;
	const gchar* _tmp6_;
	GFile* _tmp7_ = NULL;
	GFile* _tmp8_;
	self = (DejaDupOperationRestore*) base;
	_tmp0_ = ((DejaDupOperation*) self)->job;
	_tmp1_ = deja_dup_operation_restore_get_restore_files (self);
	_tmp2_ = _tmp1_;
	deja_dup_tool_job_set_restore_files (_tmp0_, _tmp2_);
	_tmp3_ = ((DejaDupOperation*) self)->job;
	_tmp4_ = self->priv->_time;
	deja_dup_tool_job_set_time (_tmp3_, _tmp4_);
	_tmp5_ = ((DejaDupOperation*) self)->job;
	_tmp6_ = self->priv->_dest;
	_tmp7_ = g_file_new_for_path (_tmp6_);
	_tmp8_ = _tmp7_;
	deja_dup_tool_job_set_local (_tmp5_, _tmp8_);
	_g_object_unref0 (_tmp8_);
	result = NULL;
	return result;
}


static Block8Data* block8_data_ref (Block8Data* _data8_) {
	g_atomic_int_inc (&_data8_->_ref_count_);
	return _data8_;
}


static void block8_data_unref (void * _userdata_) {
	Block8Data* _data8_;
	_data8_ = (Block8Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data8_->_ref_count_)) {
		DejaDupOperationRestore * self;
		self = _data8_->self;
		_g_free0 (_data8_->line);
		_g_object_unref0 (self);
		g_slice_free (Block8Data, _data8_);
	}
}


static Block9Data* block9_data_ref (Block9Data* _data9_) {
	g_atomic_int_inc (&_data9_->_ref_count_);
	return _data9_;
}


static void block9_data_unref (void * _userdata_) {
	Block9Data* _data9_;
	_data9_ = (Block9Data*) _userdata_;
	if (g_atomic_int_dec_and_test (&_data9_->_ref_count_)) {
		DejaDupOperationRestore * self;
		self = _data9_->_data8_->self;
		block8_data_unref (_data9_->_data8_);
		_data9_->_data8_ = NULL;
		g_slice_free (Block9Data, _data9_);
	}
}


static gchar* g_file_stream_read_line (FILE* self) {
	gchar* result = NULL;
	gint c = 0;
	GString* ret;
	GString* _tmp7_;
	g_return_val_if_fail (self != NULL, NULL);
	ret = NULL;
	while (TRUE) {
		gint _tmp0_ = 0;
		gint _tmp1_;
		GString* _tmp2_;
		gint _tmp4_;
		GString* _tmp5_;
		gint _tmp6_;
		_tmp0_ = fgetc (self);
		c = _tmp0_;
		_tmp1_ = c;
		if (!(_tmp1_ != EOF)) {
			break;
		}
		_tmp2_ = ret;
		if (_tmp2_ == NULL) {
			GString* _tmp3_;
			_tmp3_ = g_string_new ("");
			_g_string_free0 (ret);
			ret = _tmp3_;
		}
		_tmp4_ = c;
		if (_tmp4_ == ((gint) '\n')) {
			break;
		}
		_tmp5_ = ret;
		_tmp6_ = c;
		g_string_append_c ((GString*) _tmp5_, (gchar) _tmp6_);
	}
	_tmp7_ = ret;
	if (_tmp7_ == NULL) {
		result = NULL;
		_g_string_free0 (ret);
		return result;
	} else {
		GString* _tmp8_;
		const gchar* _tmp9_;
		gchar* _tmp10_;
		_tmp8_ = ret;
		_tmp9_ = ((GString*) _tmp8_)->str;
		_tmp10_ = g_strdup (_tmp9_);
		result = _tmp10_;
		_g_string_free0 (ret);
		return result;
	}
	_g_string_free0 (ret);
}


static gboolean string_contains (const gchar* self, const gchar* needle) {
	gboolean result = FALSE;
	const gchar* _tmp0_;
	gchar* _tmp1_ = NULL;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (needle != NULL, FALSE);
	_tmp0_ = needle;
	_tmp1_ = strstr ((gchar*) self, (gchar*) _tmp0_);
	result = _tmp1_ != NULL;
	return result;
}


static void _____lambda31_ (Block9Data* _data9_, const gchar* entry) {
	Block8Data* _data8_;
	DejaDupOperationRestore * self;
	const gchar* _tmp0_;
	const gchar* _tmp1_;
	gboolean _tmp2_ = FALSE;
	gboolean is_in;
	gboolean _tmp3_;
	_data8_ = _data9_->_data8_;
	self = _data8_->self;
	g_return_if_fail (entry != NULL);
	_tmp0_ = _data8_->line;
	_tmp1_ = entry;
	_tmp2_ = string_contains (_tmp0_, _tmp1_);
	is_in = _tmp2_;
	_tmp3_ = is_in;
	if (_tmp3_) {
		_data9_->found = TRUE;
	}
}


static void ______lambda31__gfunc (gconstpointer data, gpointer self) {
	_____lambda31_ (self, data);
}


static void _g_free0_ (gpointer var) {
	var = (g_free (var), NULL);
}


static void _g_list_free__g_free0_ (GList* self) {
	g_list_foreach (self, (GFunc) _g_free0_, NULL);
	g_list_free (self);
}


void deja_dup_operation_restore_restore_gsettings (DejaDupOperationRestore* self) {
	const gchar* _tmp0_ = NULL;
	gchar* _tmp1_;
	gchar* home_dir;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	GFile* _tmp5_ = NULL;
	GFile* _tmp6_;
	GFile* file_restore;
	GFile* _tmp7_;
	gboolean _tmp8_ = FALSE;
	gboolean tmp;
	gboolean _tmp9_;
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	_tmp0_ = g_get_home_dir ();
	_tmp1_ = g_strdup (_tmp0_);
	home_dir = _tmp1_;
	_tmp2_ = home_dir;
	_tmp3_ = g_strconcat (_tmp2_, "/.apps-gsettings", NULL);
	_tmp4_ = _tmp3_;
	_tmp5_ = g_file_new_for_path (_tmp4_);
	_tmp6_ = _tmp5_;
	_g_free0 (_tmp4_);
	file_restore = _tmp6_;
	_tmp7_ = file_restore;
	_tmp8_ = g_file_query_exists (_tmp7_, NULL);
	tmp = _tmp8_;
	_tmp9_ = tmp;
	if (_tmp9_ == TRUE) {
		{
			Block8Data* _data8_;
			const gchar* _tmp10_;
			gchar* _tmp11_;
			gchar* _tmp12_;
			FILE* _tmp13_ = NULL;
			FILE* _tmp14_;
			FILE* stream;
			FILE* _tmp15_;
			GList* schema_list;
			DejaDupSimpleSettings* _tmp16_ = NULL;
			DejaDupSimpleSettings* app_settings;
			DejaDupSimpleSettings* _tmp17_;
			gchar** _tmp18_;
			gchar** _tmp19_ = NULL;
			_data8_ = g_slice_new0 (Block8Data);
			_data8_->_ref_count_ = 1;
			_data8_->self = g_object_ref (self);
			_tmp10_ = home_dir;
			_tmp11_ = g_strconcat (_tmp10_, "/.apps-gsettings", NULL);
			_tmp12_ = _tmp11_;
			_tmp13_ = fopen (_tmp12_, "r");
			_tmp14_ = _tmp13_;
			_g_free0 (_tmp12_);
			stream = _tmp14_;
			_tmp15_ = stream;
			g_assert (_tmp15_ != NULL);
			schema_list = NULL;
			_tmp16_ = deja_dup_get_settings (DEJA_DUP_APPS_ROOT);
			app_settings = _tmp16_;
			_tmp17_ = app_settings;
			_tmp19_ = _tmp18_ = g_settings_list_children ((GSettings*) _tmp17_);
			{
				gchar** app_collection = NULL;
				gint app_collection_length1 = 0;
				gint _app_collection_size_ = 0;
				gint app_it = 0;
				app_collection = _tmp19_;
				app_collection_length1 = _vala_array_length (_tmp18_);
				for (app_it = 0; app_it < _vala_array_length (_tmp18_); app_it = app_it + 1) {
					gchar* _tmp20_;
					gchar* app = NULL;
					_tmp20_ = g_strdup (app_collection[app_it]);
					app = _tmp20_;
					{
						const gchar* _tmp21_;
						gchar* _tmp22_;
						gchar* _tmp23_;
						GFile* _tmp24_ = NULL;
						GFile* _tmp25_;
						GFile* file;
						GFile* _tmp26_;
						gboolean _tmp27_ = FALSE;
						_tmp21_ = app;
						_tmp22_ = g_strconcat ("/usr/bin/", _tmp21_, NULL);
						_tmp23_ = _tmp22_;
						_tmp24_ = g_file_new_for_path (_tmp23_);
						_tmp25_ = _tmp24_;
						_g_free0 (_tmp23_);
						file = _tmp25_;
						_tmp26_ = file;
						_tmp27_ = g_file_query_exists (_tmp26_, NULL);
						if (_tmp27_) {
							const gchar* _tmp28_;
							gchar* _tmp29_;
							gchar* _tmp30_;
							DejaDupSimpleSettings* _tmp31_ = NULL;
							DejaDupSimpleSettings* _tmp32_;
							DejaDupSimpleSettings* set;
							DejaDupSimpleSettings* _tmp33_;
							gboolean _tmp34_ = FALSE;
							gboolean val;
							gboolean _tmp35_;
							_tmp28_ = app;
							_tmp29_ = g_strconcat (DEJA_DUP_APPS_ROOT ".", _tmp28_, NULL);
							_tmp30_ = _tmp29_;
							_tmp31_ = deja_dup_get_settings (_tmp30_);
							_tmp32_ = _tmp31_;
							_g_free0 (_tmp30_);
							set = _tmp32_;
							_tmp33_ = set;
							_tmp34_ = g_settings_get_boolean ((GSettings*) _tmp33_, DEJA_DUP_BACKUP_KEY);
							val = _tmp34_;
							_tmp35_ = val;
							if (_tmp35_ == TRUE) {
								DejaDupSimpleSettings* _tmp36_;
								gchar* _tmp37_ = NULL;
								gchar* schema;
								const gchar* _tmp38_;
								_tmp36_ = set;
								_tmp37_ = g_settings_get_string ((GSettings*) _tmp36_, "settings");
								schema = _tmp37_;
								_tmp38_ = schema;
								if (g_strcmp0 (_tmp38_, "") != 0) {
									const gchar* _tmp39_;
									gchar* _tmp40_;
									_tmp39_ = schema;
									_tmp40_ = g_strdup (_tmp39_);
									schema_list = g_list_append (schema_list, _tmp40_);
								}
								_g_free0 (schema);
							}
							_g_object_unref0 (set);
						}
						_g_object_unref0 (file);
						_g_free0 (app);
					}
				}
				app_collection = (_vala_array_free (app_collection, app_collection_length1, (GDestroyNotify) g_free), NULL);
			}
			_data8_->line = NULL;
			while (TRUE) {
				Block9Data* _data9_;
				FILE* _tmp41_;
				gchar* _tmp42_ = NULL;
				const gchar* _tmp43_;
				GList* _tmp44_;
				gboolean _tmp45_;
				gchar* ls_stdout = NULL;
				gchar* ls_stderr = NULL;
				gint ls_status = 0;
				const gchar* _tmp46_;
				gchar** _tmp47_;
				gchar** _tmp48_ = NULL;
				gchar** words;
				gint words_length1;
				gint _words_size_;
				gchar** _tmp49_;
				gint _tmp49__length1;
				const gchar* _tmp50_;
				DejaDupSimpleSettings* _tmp51_ = NULL;
				DejaDupSimpleSettings* appsetlist;
				DejaDupSimpleSettings* _tmp52_;
				gchar** _tmp53_;
				gint _tmp53__length1;
				const gchar* _tmp54_;
				GVariant* _tmp55_ = NULL;
				GVariant* t_val;
				GVariant* _tmp56_;
				const gchar* _tmp57_ = NULL;
				gchar* _tmp58_;
				gchar* type;
				const gchar* _tmp59_;
				const gchar* _tmp80_;
				const gchar* _tmp101_;
				const gchar* _tmp122_;
				_data9_ = g_slice_new0 (Block9Data);
				_data9_->_ref_count_ = 1;
				_data9_->_data8_ = block8_data_ref (_data8_);
				_tmp41_ = stream;
				_tmp42_ = g_file_stream_read_line (_tmp41_);
				_g_free0 (_data8_->line);
				_data8_->line = _tmp42_;
				_tmp43_ = _data8_->line;
				if (!(_tmp43_ != NULL)) {
					block9_data_unref (_data9_);
					_data9_ = NULL;
					break;
				}
				_data9_->found = FALSE;
				_tmp44_ = schema_list;
				g_list_foreach (_tmp44_, ______lambda31__gfunc, _data9_);
				_tmp45_ = _data9_->found;
				if (!_tmp45_) {
					block9_data_unref (_data9_);
					_data9_ = NULL;
					continue;
				}
				_tmp46_ = _data8_->line;
				_tmp48_ = _tmp47_ = g_strsplit (_tmp46_, " ", 0);
				words = _tmp48_;
				words_length1 = _vala_array_length (_tmp47_);
				_words_size_ = words_length1;
				_tmp49_ = words;
				_tmp49__length1 = words_length1;
				_tmp50_ = _tmp49_[0];
				_tmp51_ = deja_dup_get_app_settings (_tmp50_, NULL);
				appsetlist = _tmp51_;
				_tmp52_ = appsetlist;
				_tmp53_ = words;
				_tmp53__length1 = words_length1;
				_tmp54_ = _tmp53_[1];
				_tmp55_ = g_settings_get_value ((GSettings*) _tmp52_, _tmp54_);
				t_val = _tmp55_;
				_tmp56_ = t_val;
				_tmp57_ = g_variant_get_type_string (_tmp56_);
				_tmp58_ = g_strdup (_tmp57_);
				type = _tmp58_;
				_tmp59_ = type;
				if (g_strcmp0 ("b", _tmp59_) == 0) {
					gchar** _tmp60_;
					gint _tmp60__length1;
					const gchar* _tmp61_;
					gchar* _tmp62_;
					gchar* _tmp63_;
					gchar* _tmp64_;
					gchar* _tmp65_;
					gchar** _tmp66_;
					gint _tmp66__length1;
					const gchar* _tmp67_;
					gchar* _tmp68_;
					gchar* _tmp69_;
					gchar* _tmp70_;
					gchar* _tmp71_;
					gchar** _tmp72_;
					gint _tmp72__length1;
					const gchar* _tmp73_;
					gchar* _tmp74_;
					gchar* _tmp75_;
					gchar* command;
					const gchar* _tmp76_;
					gchar* _tmp77_ = NULL;
					gchar* _tmp78_ = NULL;
					gint _tmp79_ = 0;
					_tmp60_ = words;
					_tmp60__length1 = words_length1;
					_tmp61_ = _tmp60_[0];
					_tmp62_ = g_strconcat ("gsettings set ", _tmp61_, NULL);
					_tmp63_ = _tmp62_;
					_tmp64_ = g_strconcat (_tmp63_, " ", NULL);
					_tmp65_ = _tmp64_;
					_tmp66_ = words;
					_tmp66__length1 = words_length1;
					_tmp67_ = _tmp66_[1];
					_tmp68_ = g_strconcat (_tmp65_, _tmp67_, NULL);
					_tmp69_ = _tmp68_;
					_tmp70_ = g_strconcat (_tmp69_, " ", NULL);
					_tmp71_ = _tmp70_;
					_tmp72_ = words;
					_tmp72__length1 = words_length1;
					_tmp73_ = _tmp72_[2];
					_tmp74_ = g_strconcat (_tmp71_, _tmp73_, NULL);
					_tmp75_ = _tmp74_;
					_g_free0 (_tmp71_);
					_g_free0 (_tmp69_);
					_g_free0 (_tmp65_);
					_g_free0 (_tmp63_);
					command = _tmp75_;
					_tmp76_ = command;
					g_spawn_command_line_sync (_tmp76_, &_tmp77_, &_tmp78_, &_tmp79_, &_inner_error_);
					_g_free0 (ls_stdout);
					ls_stdout = _tmp77_;
					_g_free0 (ls_stderr);
					ls_stderr = _tmp78_;
					ls_status = _tmp79_;
					if (_inner_error_ != NULL) {
						_g_free0 (command);
						_g_free0 (type);
						_g_variant_unref0 (t_val);
						_g_object_unref0 (appsetlist);
						words = (_vala_array_free (words, words_length1, (GDestroyNotify) g_free), NULL);
						_g_free0 (ls_stderr);
						_g_free0 (ls_stdout);
						block9_data_unref (_data9_);
						_data9_ = NULL;
						_g_object_unref0 (app_settings);
						__g_list_free__g_free0_0 (schema_list);
						_fclose0 (stream);
						block8_data_unref (_data8_);
						_data8_ = NULL;
						goto __catch28_g_error;
					}
					_g_free0 (command);
				}
				_tmp80_ = type;
				if (g_strcmp0 ("i", _tmp80_) == 0) {
					gchar** _tmp81_;
					gint _tmp81__length1;
					const gchar* _tmp82_;
					gchar* _tmp83_;
					gchar* _tmp84_;
					gchar* _tmp85_;
					gchar* _tmp86_;
					gchar** _tmp87_;
					gint _tmp87__length1;
					const gchar* _tmp88_;
					gchar* _tmp89_;
					gchar* _tmp90_;
					gchar* _tmp91_;
					gchar* _tmp92_;
					gchar** _tmp93_;
					gint _tmp93__length1;
					const gchar* _tmp94_;
					gchar* _tmp95_;
					gchar* _tmp96_;
					gchar* command;
					const gchar* _tmp97_;
					gchar* _tmp98_ = NULL;
					gchar* _tmp99_ = NULL;
					gint _tmp100_ = 0;
					_tmp81_ = words;
					_tmp81__length1 = words_length1;
					_tmp82_ = _tmp81_[0];
					_tmp83_ = g_strconcat ("gsettings set ", _tmp82_, NULL);
					_tmp84_ = _tmp83_;
					_tmp85_ = g_strconcat (_tmp84_, " ", NULL);
					_tmp86_ = _tmp85_;
					_tmp87_ = words;
					_tmp87__length1 = words_length1;
					_tmp88_ = _tmp87_[1];
					_tmp89_ = g_strconcat (_tmp86_, _tmp88_, NULL);
					_tmp90_ = _tmp89_;
					_tmp91_ = g_strconcat (_tmp90_, " ", NULL);
					_tmp92_ = _tmp91_;
					_tmp93_ = words;
					_tmp93__length1 = words_length1;
					_tmp94_ = _tmp93_[2];
					_tmp95_ = g_strconcat (_tmp92_, _tmp94_, NULL);
					_tmp96_ = _tmp95_;
					_g_free0 (_tmp92_);
					_g_free0 (_tmp90_);
					_g_free0 (_tmp86_);
					_g_free0 (_tmp84_);
					command = _tmp96_;
					_tmp97_ = command;
					g_spawn_command_line_sync (_tmp97_, &_tmp98_, &_tmp99_, &_tmp100_, &_inner_error_);
					_g_free0 (ls_stdout);
					ls_stdout = _tmp98_;
					_g_free0 (ls_stderr);
					ls_stderr = _tmp99_;
					ls_status = _tmp100_;
					if (_inner_error_ != NULL) {
						_g_free0 (command);
						_g_free0 (type);
						_g_variant_unref0 (t_val);
						_g_object_unref0 (appsetlist);
						words = (_vala_array_free (words, words_length1, (GDestroyNotify) g_free), NULL);
						_g_free0 (ls_stderr);
						_g_free0 (ls_stdout);
						block9_data_unref (_data9_);
						_data9_ = NULL;
						_g_object_unref0 (app_settings);
						__g_list_free__g_free0_0 (schema_list);
						_fclose0 (stream);
						block8_data_unref (_data8_);
						_data8_ = NULL;
						goto __catch28_g_error;
					}
					_g_free0 (command);
				}
				_tmp101_ = type;
				if (g_strcmp0 ("s", _tmp101_) == 0) {
					gchar** _tmp102_;
					gint _tmp102__length1;
					const gchar* _tmp103_;
					gchar* _tmp104_;
					gchar* _tmp105_;
					gchar* _tmp106_;
					gchar* _tmp107_;
					gchar** _tmp108_;
					gint _tmp108__length1;
					const gchar* _tmp109_;
					gchar* _tmp110_;
					gchar* _tmp111_;
					gchar* _tmp112_;
					gchar* _tmp113_;
					gchar** _tmp114_;
					gint _tmp114__length1;
					const gchar* _tmp115_;
					gchar* _tmp116_;
					gchar* _tmp117_;
					gchar* command;
					const gchar* _tmp118_;
					gchar* _tmp119_ = NULL;
					gchar* _tmp120_ = NULL;
					gint _tmp121_ = 0;
					_tmp102_ = words;
					_tmp102__length1 = words_length1;
					_tmp103_ = _tmp102_[0];
					_tmp104_ = g_strconcat ("gsettings set ", _tmp103_, NULL);
					_tmp105_ = _tmp104_;
					_tmp106_ = g_strconcat (_tmp105_, " ", NULL);
					_tmp107_ = _tmp106_;
					_tmp108_ = words;
					_tmp108__length1 = words_length1;
					_tmp109_ = _tmp108_[1];
					_tmp110_ = g_strconcat (_tmp107_, _tmp109_, NULL);
					_tmp111_ = _tmp110_;
					_tmp112_ = g_strconcat (_tmp111_, " ", NULL);
					_tmp113_ = _tmp112_;
					_tmp114_ = words;
					_tmp114__length1 = words_length1;
					_tmp115_ = _tmp114_[2];
					_tmp116_ = g_strconcat (_tmp113_, _tmp115_, NULL);
					_tmp117_ = _tmp116_;
					_g_free0 (_tmp113_);
					_g_free0 (_tmp111_);
					_g_free0 (_tmp107_);
					_g_free0 (_tmp105_);
					command = _tmp117_;
					_tmp118_ = command;
					g_spawn_command_line_sync (_tmp118_, &_tmp119_, &_tmp120_, &_tmp121_, &_inner_error_);
					_g_free0 (ls_stdout);
					ls_stdout = _tmp119_;
					_g_free0 (ls_stderr);
					ls_stderr = _tmp120_;
					ls_status = _tmp121_;
					if (_inner_error_ != NULL) {
						_g_free0 (command);
						_g_free0 (type);
						_g_variant_unref0 (t_val);
						_g_object_unref0 (appsetlist);
						words = (_vala_array_free (words, words_length1, (GDestroyNotify) g_free), NULL);
						_g_free0 (ls_stderr);
						_g_free0 (ls_stdout);
						block9_data_unref (_data9_);
						_data9_ = NULL;
						_g_object_unref0 (app_settings);
						__g_list_free__g_free0_0 (schema_list);
						_fclose0 (stream);
						block8_data_unref (_data8_);
						_data8_ = NULL;
						goto __catch28_g_error;
					}
					_g_free0 (command);
				}
				_tmp122_ = type;
				if (g_strcmp0 ("as", _tmp122_) == 0) {
					gchar** _tmp123_;
					gint _tmp123__length1;
					const gchar* _tmp124_;
					gchar** _tmp125_;
					gchar** _tmp126_ = NULL;
					gchar** item;
					gint item_length1;
					gint _item_size_;
					gchar** _tmp127_;
					gint _tmp127__length1;
					const gchar* _tmp128_;
					gchar* _tmp129_;
					gchar* _tmp130_;
					gchar* _tmp131_;
					gchar* _tmp132_;
					gchar** _tmp133_;
					gint _tmp133__length1;
					const gchar* _tmp134_;
					gchar* _tmp135_;
					gchar* _tmp136_;
					gchar* _tmp137_;
					gchar* _tmp138_;
					gchar* command;
					gchar** _tmp139_;
					gint _tmp139__length1;
					const gchar* _tmp158_;
					gchar* _tmp159_;
					const gchar* _tmp160_;
					gchar* _tmp161_ = NULL;
					gchar* _tmp162_ = NULL;
					gint _tmp163_ = 0;
					_tmp123_ = words;
					_tmp123__length1 = words_length1;
					_tmp124_ = _tmp123_[2];
					_tmp126_ = _tmp125_ = g_strsplit (_tmp124_, ",", 0);
					item = _tmp126_;
					item_length1 = _vala_array_length (_tmp125_);
					_item_size_ = item_length1;
					_tmp127_ = words;
					_tmp127__length1 = words_length1;
					_tmp128_ = _tmp127_[0];
					_tmp129_ = g_strconcat ("gsettings set ", _tmp128_, NULL);
					_tmp130_ = _tmp129_;
					_tmp131_ = g_strconcat (_tmp130_, " ", NULL);
					_tmp132_ = _tmp131_;
					_tmp133_ = words;
					_tmp133__length1 = words_length1;
					_tmp134_ = _tmp133_[1];
					_tmp135_ = g_strconcat (_tmp132_, _tmp134_, NULL);
					_tmp136_ = _tmp135_;
					_tmp137_ = g_strconcat (_tmp136_, " \"[", NULL);
					_tmp138_ = _tmp137_;
					_g_free0 (_tmp136_);
					_g_free0 (_tmp132_);
					_g_free0 (_tmp130_);
					command = _tmp138_;
					_tmp139_ = item;
					_tmp139__length1 = item_length1;
					{
						gchar** ss_collection = NULL;
						gint ss_collection_length1 = 0;
						gint _ss_collection_size_ = 0;
						gint ss_it = 0;
						ss_collection = _tmp139_;
						ss_collection_length1 = _tmp139__length1;
						for (ss_it = 0; ss_it < _tmp139__length1; ss_it = ss_it + 1) {
							gchar* _tmp140_;
							gchar* ss = NULL;
							_tmp140_ = g_strdup (ss_collection[ss_it]);
							ss = _tmp140_;
							{
								gchar** _tmp141_;
								gint _tmp141__length1;
								const gchar* _tmp142_;
								const gchar* _tmp143_;
								_tmp141_ = item;
								_tmp141__length1 = item_length1;
								_tmp142_ = _tmp141_[0];
								_tmp143_ = ss;
								if (g_strcmp0 (_tmp142_, _tmp143_) == 0) {
									const gchar* _tmp144_;
									gchar* _tmp145_;
									gchar* _tmp146_;
									const gchar* _tmp147_;
									gchar* _tmp148_;
									gchar* _tmp149_;
									gchar* _tmp150_;
									_tmp144_ = command;
									_tmp145_ = g_strconcat (_tmp144_, "'", NULL);
									_tmp146_ = _tmp145_;
									_tmp147_ = ss;
									_tmp148_ = g_strconcat (_tmp146_, _tmp147_, NULL);
									_tmp149_ = _tmp148_;
									_tmp150_ = g_strconcat (_tmp149_, "'", NULL);
									_g_free0 (command);
									command = _tmp150_;
									_g_free0 (_tmp149_);
									_g_free0 (_tmp146_);
								} else {
									const gchar* _tmp151_;
									gchar* _tmp152_;
									gchar* _tmp153_;
									const gchar* _tmp154_;
									gchar* _tmp155_;
									gchar* _tmp156_;
									gchar* _tmp157_;
									_tmp151_ = command;
									_tmp152_ = g_strconcat (_tmp151_, ",'", NULL);
									_tmp153_ = _tmp152_;
									_tmp154_ = ss;
									_tmp155_ = g_strconcat (_tmp153_, _tmp154_, NULL);
									_tmp156_ = _tmp155_;
									_tmp157_ = g_strconcat (_tmp156_, "'", NULL);
									_g_free0 (command);
									command = _tmp157_;
									_g_free0 (_tmp156_);
									_g_free0 (_tmp153_);
								}
								_g_free0 (ss);
							}
						}
					}
					_tmp158_ = command;
					_tmp159_ = g_strconcat (_tmp158_, "]\"", NULL);
					_g_free0 (command);
					command = _tmp159_;
					_tmp160_ = command;
					g_spawn_command_line_sync (_tmp160_, &_tmp161_, &_tmp162_, &_tmp163_, &_inner_error_);
					_g_free0 (ls_stdout);
					ls_stdout = _tmp161_;
					_g_free0 (ls_stderr);
					ls_stderr = _tmp162_;
					ls_status = _tmp163_;
					if (_inner_error_ != NULL) {
						_g_free0 (command);
						item = (_vala_array_free (item, item_length1, (GDestroyNotify) g_free), NULL);
						_g_free0 (type);
						_g_variant_unref0 (t_val);
						_g_object_unref0 (appsetlist);
						words = (_vala_array_free (words, words_length1, (GDestroyNotify) g_free), NULL);
						_g_free0 (ls_stderr);
						_g_free0 (ls_stdout);
						block9_data_unref (_data9_);
						_data9_ = NULL;
						_g_object_unref0 (app_settings);
						__g_list_free__g_free0_0 (schema_list);
						_fclose0 (stream);
						block8_data_unref (_data8_);
						_data8_ = NULL;
						goto __catch28_g_error;
					}
					_g_free0 (command);
					item = (_vala_array_free (item, item_length1, (GDestroyNotify) g_free), NULL);
				}
				_g_free0 (type);
				_g_variant_unref0 (t_val);
				_g_object_unref0 (appsetlist);
				words = (_vala_array_free (words, words_length1, (GDestroyNotify) g_free), NULL);
				_g_free0 (ls_stderr);
				_g_free0 (ls_stdout);
				block9_data_unref (_data9_);
				_data9_ = NULL;
			}
			_g_object_unref0 (app_settings);
			__g_list_free__g_free0_0 (schema_list);
			_fclose0 (stream);
			block8_data_unref (_data8_);
			_data8_ = NULL;
		}
		goto __finally28;
		__catch28_g_error:
		{
			GError* e = NULL;
			FILE* _tmp164_;
			GError* _tmp165_;
			const gchar* _tmp166_;
			e = _inner_error_;
			_inner_error_ = NULL;
			_tmp164_ = stdout;
			_tmp165_ = e;
			_tmp166_ = _tmp165_->message;
			fprintf (_tmp164_, "Error: %s\n", _tmp166_);
			_g_error_free0 (e);
		}
		__finally28:
		if (_inner_error_ != NULL) {
			_g_object_unref0 (file_restore);
			_g_free0 (home_dir);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return;
		}
	} else {
		FILE* _tmp167_;
		_tmp167_ = stdout;
		fprintf (_tmp167_, "File not found Error:\n");
	}
	_g_object_unref0 (file_restore);
	_g_free0 (home_dir);
}


static void deja_dup_operation_restore_real_operation_finished_data_free (gpointer _data) {
	DejaDupOperationRestoreOperationFinishedData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->job);
	_g_free0 (_data_->detail);
	_g_object_unref0 (_data_->self);
	g_slice_free (DejaDupOperationRestoreOperationFinishedData, _data_);
}


static void deja_dup_operation_restore_real_operation_finished (DejaDupOperation* base, DejaDupToolJob* job, gboolean success, gboolean cancelled, const gchar* detail, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	DejaDupOperationRestore * self;
	DejaDupOperationRestoreOperationFinishedData* _data_;
	DejaDupOperationRestore* _tmp0_;
	DejaDupToolJob* _tmp1_;
	DejaDupToolJob* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	const gchar* _tmp5_;
	gchar* _tmp6_;
	self = (DejaDupOperationRestore*) base;
	_data_ = g_slice_new0 (DejaDupOperationRestoreOperationFinishedData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, deja_dup_operation_restore_real_operation_finished);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, deja_dup_operation_restore_real_operation_finished_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = job;
	_tmp2_ = _g_object_ref0 (_tmp1_);
	_data_->job = _tmp2_;
	_tmp3_ = success;
	_data_->success = _tmp3_;
	_tmp4_ = cancelled;
	_data_->cancelled = _tmp4_;
	_tmp5_ = detail;
	_tmp6_ = g_strdup (_tmp5_);
	_data_->detail = _tmp6_;
	deja_dup_operation_restore_real_operation_finished_co (_data_);
}


static void deja_dup_operation_restore_real_operation_finished_finish (DejaDupOperation* base, GAsyncResult* _res_) {
	DejaDupOperationRestoreOperationFinishedData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void deja_dup_operation_restore_operation_finished_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	DejaDupOperationRestoreOperationFinishedData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	deja_dup_operation_restore_real_operation_finished_co (_data_);
}


static gboolean deja_dup_operation_restore_real_operation_finished_co (DejaDupOperationRestoreOperationFinishedData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->success;
	if (_data_->_tmp0_) {
		deja_dup_update_last_run_timestamp (DEJA_DUP_TIMESTAMP_TYPE_RESTORE);
	}
	_data_->_tmp1_ = _data_->job;
	_data_->_tmp2_ = _data_->success;
	_data_->_tmp3_ = _data_->cancelled;
	_data_->_tmp4_ = _data_->detail;
	_data_->_state_ = 1;
	DEJA_DUP_OPERATION_CLASS (deja_dup_operation_restore_parent_class)->operation_finished (DEJA_DUP_OPERATION (_data_->self), _data_->_tmp1_, _data_->_tmp2_, _data_->_tmp3_, _data_->_tmp4_, deja_dup_operation_restore_operation_finished_ready, _data_);
	return FALSE;
	_state_1:
	DEJA_DUP_OPERATION_CLASS (deja_dup_operation_restore_parent_class)->operation_finished_finish (DEJA_DUP_OPERATION (_data_->self), _data_->_res_);
	deja_dup_operation_restore_restore_gsettings (_data_->self);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


const gchar* deja_dup_operation_restore_get_dest (DejaDupOperationRestore* self) {
	const gchar* result;
	const gchar* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_dest;
	result = _tmp0_;
	return result;
}


static void deja_dup_operation_restore_set_dest (DejaDupOperationRestore* self, const gchar* value) {
	const gchar* _tmp0_;
	gchar* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = value;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 (self->priv->_dest);
	self->priv->_dest = _tmp1_;
	g_object_notify ((GObject *) self, "dest");
}


const gchar* deja_dup_operation_restore_get_time (DejaDupOperationRestore* self) {
	const gchar* result;
	const gchar* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_time;
	result = _tmp0_;
	return result;
}


static void deja_dup_operation_restore_set_time (DejaDupOperationRestore* self, const gchar* value) {
	const gchar* _tmp0_;
	gchar* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = value;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 (self->priv->_time);
	self->priv->_time = _tmp1_;
	g_object_notify ((GObject *) self, "time");
}


GList* deja_dup_operation_restore_get_restore_files (DejaDupOperationRestore* self) {
	GList* result;
	GList* _tmp0_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = self->priv->_restore_files;
	result = _tmp0_;
	return result;
}


static void deja_dup_operation_restore_set_restore_files (DejaDupOperationRestore* self, GList* value) {
	GList* _tmp0_;
	GList* _tmp3_;
	GList* _tmp4_ = NULL;
	GList* _tmp5_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->_restore_files;
	{
		GList* f_collection = NULL;
		GList* f_it = NULL;
		f_collection = _tmp0_;
		for (f_it = f_collection; f_it != NULL; f_it = f_it->next) {
			GFile* _tmp1_;
			GFile* f = NULL;
			_tmp1_ = _g_object_ref0 ((GFile*) f_it->data);
			f = _tmp1_;
			{
				GFile* _tmp2_;
				_tmp2_ = f;
				g_object_unref ((GObject*) _tmp2_);
				_g_object_unref0 (f);
			}
		}
	}
	_tmp3_ = value;
	_tmp4_ = g_list_copy (_tmp3_);
	__g_list_free__g_object_unref0_0 (self->priv->_restore_files);
	self->priv->_restore_files = _tmp4_;
	_tmp5_ = self->priv->_restore_files;
	{
		GList* f_collection = NULL;
		GList* f_it = NULL;
		f_collection = _tmp5_;
		for (f_it = f_collection; f_it != NULL; f_it = f_it->next) {
			GFile* _tmp6_;
			GFile* f = NULL;
			_tmp6_ = _g_object_ref0 ((GFile*) f_it->data);
			f = _tmp6_;
			{
				GFile* _tmp7_;
				_tmp7_ = f;
				g_object_ref ((GObject*) _tmp7_);
				_g_object_unref0 (f);
			}
		}
	}
	g_object_notify ((GObject *) self, "restore-files");
}


static void deja_dup_operation_restore_class_init (DejaDupOperationRestoreClass * klass) {
	deja_dup_operation_restore_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (DejaDupOperationRestorePrivate));
	DEJA_DUP_OPERATION_CLASS (klass)->start = deja_dup_operation_restore_real_start;
	DEJA_DUP_OPERATION_CLASS (klass)->start_finish = deja_dup_operation_restore_real_start_finish;
	DEJA_DUP_OPERATION_CLASS (klass)->make_argv = deja_dup_operation_restore_real_make_argv;
	DEJA_DUP_OPERATION_CLASS (klass)->operation_finished = deja_dup_operation_restore_real_operation_finished;
	DEJA_DUP_OPERATION_CLASS (klass)->operation_finished_finish = deja_dup_operation_restore_real_operation_finished_finish;
	G_OBJECT_CLASS (klass)->get_property = _vala_deja_dup_operation_restore_get_property;
	G_OBJECT_CLASS (klass)->set_property = _vala_deja_dup_operation_restore_set_property;
	G_OBJECT_CLASS (klass)->finalize = deja_dup_operation_restore_finalize;
	g_object_class_install_property (G_OBJECT_CLASS (klass), DEJA_DUP_OPERATION_RESTORE_DEST, g_param_spec_string ("dest", "dest", "dest", NULL, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	g_object_class_install_property (G_OBJECT_CLASS (klass), DEJA_DUP_OPERATION_RESTORE_TIME, g_param_spec_string ("time", "time", "time", NULL, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
	g_object_class_install_property (G_OBJECT_CLASS (klass), DEJA_DUP_OPERATION_RESTORE_RESTORE_FILES, g_param_spec_pointer ("restore-files", "restore-files", "restore-files", G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE | G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));
}


static void deja_dup_operation_restore_instance_init (DejaDupOperationRestore * self) {
	self->priv = DEJA_DUP_OPERATION_RESTORE_GET_PRIVATE (self);
}


static void deja_dup_operation_restore_finalize (GObject* obj) {
	DejaDupOperationRestore * self;
	self = DEJA_DUP_OPERATION_RESTORE (obj);
	_g_free0 (self->priv->_dest);
	_g_free0 (self->priv->_time);
	__g_list_free__g_object_unref0_0 (self->priv->_restore_files);
	G_OBJECT_CLASS (deja_dup_operation_restore_parent_class)->finalize (obj);
}


GType deja_dup_operation_restore_get_type (void) {
	static volatile gsize deja_dup_operation_restore_type_id__volatile = 0;
	if (g_once_init_enter (&deja_dup_operation_restore_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (DejaDupOperationRestoreClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) deja_dup_operation_restore_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (DejaDupOperationRestore), 0, (GInstanceInitFunc) deja_dup_operation_restore_instance_init, NULL };
		GType deja_dup_operation_restore_type_id;
		deja_dup_operation_restore_type_id = g_type_register_static (DEJA_DUP_TYPE_OPERATION, "DejaDupOperationRestore", &g_define_type_info, 0);
		g_once_init_leave (&deja_dup_operation_restore_type_id__volatile, deja_dup_operation_restore_type_id);
	}
	return deja_dup_operation_restore_type_id__volatile;
}


static void _vala_deja_dup_operation_restore_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec) {
	DejaDupOperationRestore * self;
	self = DEJA_DUP_OPERATION_RESTORE (object);
	switch (property_id) {
		case DEJA_DUP_OPERATION_RESTORE_DEST:
		g_value_set_string (value, deja_dup_operation_restore_get_dest (self));
		break;
		case DEJA_DUP_OPERATION_RESTORE_TIME:
		g_value_set_string (value, deja_dup_operation_restore_get_time (self));
		break;
		case DEJA_DUP_OPERATION_RESTORE_RESTORE_FILES:
		g_value_set_pointer (value, deja_dup_operation_restore_get_restore_files (self));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}


static void _vala_deja_dup_operation_restore_set_property (GObject * object, guint property_id, const GValue * value, GParamSpec * pspec) {
	DejaDupOperationRestore * self;
	self = DEJA_DUP_OPERATION_RESTORE (object);
	switch (property_id) {
		case DEJA_DUP_OPERATION_RESTORE_DEST:
		deja_dup_operation_restore_set_dest (self, g_value_get_string (value));
		break;
		case DEJA_DUP_OPERATION_RESTORE_TIME:
		deja_dup_operation_restore_set_time (self, g_value_get_string (value));
		break;
		case DEJA_DUP_OPERATION_RESTORE_RESTORE_FILES:
		deja_dup_operation_restore_set_restore_files (self, g_value_get_pointer (value));
		break;
		default:
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}


static gint _vala_array_length (gpointer array) {
	int length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}



