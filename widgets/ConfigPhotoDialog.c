/* ConfigPhotoDialog.c generated by valac 0.16.1, the Vala compiler
 * generated from ConfigPhotoDialog.vala, do not modify */

/* -*- Mode: Vala; indent-tabs-mode: nil; tab-width: 2 -*- */

#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <glib/gi18n-lib.h>
#include <common.h>
#include <gio/gio.h>
#include <stdlib.h>
#include <string.h>


#define DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG (deja_dup_config_photo_dialog_get_type ())
#define DEJA_DUP_CONFIG_PHOTO_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG, DejaDupConfigPhotoDialog))
#define DEJA_DUP_CONFIG_PHOTO_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG, DejaDupConfigPhotoDialogClass))
#define DEJA_DUP_IS_CONFIG_PHOTO_DIALOG(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG))
#define DEJA_DUP_IS_CONFIG_PHOTO_DIALOG_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG))
#define DEJA_DUP_CONFIG_PHOTO_DIALOG_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG, DejaDupConfigPhotoDialogClass))

typedef struct _DejaDupConfigPhotoDialog DejaDupConfigPhotoDialog;
typedef struct _DejaDupConfigPhotoDialogClass DejaDupConfigPhotoDialogClass;
typedef struct _DejaDupConfigPhotoDialogPrivate DejaDupConfigPhotoDialogPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_variant_unref0(var) ((var == NULL) ? NULL : (var = (g_variant_unref (var), NULL)))

struct _DejaDupConfigPhotoDialog {
	GtkDialog parent_instance;
	DejaDupConfigPhotoDialogPrivate * priv;
};

struct _DejaDupConfigPhotoDialogClass {
	GtkDialogClass parent_class;
};

struct _DejaDupConfigPhotoDialogPrivate {
	GtkSwitch* button;
};


static gpointer deja_dup_config_photo_dialog_parent_class = NULL;

GType deja_dup_config_photo_dialog_get_type (void) G_GNUC_CONST;
#define DEJA_DUP_CONFIG_PHOTO_DIALOG_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG, DejaDupConfigPhotoDialogPrivate))
enum  {
	DEJA_DUP_CONFIG_PHOTO_DIALOG_DUMMY_PROPERTY
};
DejaDupConfigPhotoDialog* deja_dup_config_photo_dialog_new (void);
DejaDupConfigPhotoDialog* deja_dup_config_photo_dialog_construct (GType object_type);
static void deja_dup_config_photo_dialog_create_widgets (DejaDupConfigPhotoDialog* self);
static void deja_dup_config_photo_dialog_connect_signals (DejaDupConfigPhotoDialog* self);
static void deja_dup_config_photo_dialog_handle_toggled (DejaDupConfigPhotoDialog* self);
static void _deja_dup_config_photo_dialog_handle_toggled_g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self);
static void deja_dup_config_photo_dialog_on_response (DejaDupConfigPhotoDialog* self, GtkDialog* source, gint response_id);
static void _deja_dup_config_photo_dialog_on_response_gtk_dialog_response (GtkDialog* _sender, gint response_id, gpointer self);
static void _vala_array_add5 (const gchar*** array, int* length, int* size, const gchar* value);
static void _vala_array_add6 (gchar*** array, int* length, int* size, gchar* value);
static void deja_dup_config_photo_dialog_finalize (GObject* obj);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);


DejaDupConfigPhotoDialog* deja_dup_config_photo_dialog_construct (GType object_type) {
	DejaDupConfigPhotoDialog * self = NULL;
	self = (DejaDupConfigPhotoDialog*) g_object_new (object_type, NULL);
	gtk_container_set_border_width ((GtkContainer*) self, (guint) 5);
	gtk_window_set_default_size ((GtkWindow*) self, 300, 100);
	gtk_window_set_modal ((GtkWindow*) self, TRUE);
	deja_dup_config_photo_dialog_create_widgets (self);
	deja_dup_config_photo_dialog_connect_signals (self);
	return self;
}


DejaDupConfigPhotoDialog* deja_dup_config_photo_dialog_new (void) {
	return deja_dup_config_photo_dialog_construct (DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG);
}


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void _deja_dup_config_photo_dialog_handle_toggled_g_object_notify (GObject* _sender, GParamSpec* pspec, gpointer self) {
	deja_dup_config_photo_dialog_handle_toggled (self);
}


static void deja_dup_config_photo_dialog_create_widgets (DejaDupConfigPhotoDialog* self) {
	const gchar* _tmp0_ = NULL;
	GtkLabel* _tmp1_;
	GtkLabel* _tmp2_;
	GtkLabel* label;
	GtkSwitch* _tmp3_;
	GtkSwitch* _tmp4_;
	const gchar* _tmp5_ = NULL;
	GtkLabel* _tmp6_;
	GtkLabel* _tmp7_;
	GtkLabel* description;
	GtkBox* _tmp8_;
	GtkBox* _tmp9_;
	GtkBox* hbox;
	GtkSwitch* _tmp10_;
	GtkBox* _tmp11_ = NULL;
	GtkBox* _tmp12_;
	GtkBox* content;
	DejaDupSimpleSettings* _tmp13_ = NULL;
	DejaDupSimpleSettings* settings;
	gboolean _tmp14_ = FALSE;
	gboolean value;
	GtkSwitch* _tmp15_;
	GtkSwitch* _tmp16_;
	g_return_if_fail (self != NULL);
	_tmp0_ = _ ("Photo Stream");
	_tmp1_ = (GtkLabel*) gtk_label_new_with_mnemonic (_tmp0_);
	_tmp2_ = g_object_ref_sink (_tmp1_);
	label = _tmp2_;
	_tmp3_ = (GtkSwitch*) gtk_switch_new ();
	_tmp4_ = g_object_ref_sink (_tmp3_);
	_g_object_unref0 (self->priv->button);
	self->priv->button = _tmp4_;
	_tmp5_ = _ ("Automatically upload photos and send them to all of you devices.");
	_tmp6_ = (GtkLabel*) gtk_label_new_with_mnemonic (_tmp5_);
	_tmp7_ = g_object_ref_sink (_tmp6_);
	description = _tmp7_;
	g_object_set ((GObject*) description, "use-markup", TRUE, "xalign", 0.5f, NULL);
	_tmp8_ = (GtkBox*) gtk_box_new (GTK_ORIENTATION_HORIZONTAL, 20);
	_tmp9_ = g_object_ref_sink (_tmp8_);
	hbox = _tmp9_;
	gtk_box_pack_start (hbox, (GtkWidget*) label, FALSE, TRUE, (guint) 0);
	_tmp10_ = self->priv->button;
	gtk_box_pack_end (hbox, (GtkWidget*) _tmp10_, FALSE, FALSE, (guint) 0);
	_tmp11_ = gtk_dialog_get_content_area ((GtkDialog*) self);
	_tmp12_ = _g_object_ref0 (GTK_IS_BOX (_tmp11_) ? ((GtkBox*) _tmp11_) : NULL);
	content = _tmp12_;
	gtk_box_pack_start (content, (GtkWidget*) hbox, FALSE, TRUE, (guint) 0);
	gtk_box_set_spacing (content, 10);
	_tmp13_ = deja_dup_get_settings (DEJA_DUP_APPS_ROOT ".photo-stream");
	settings = _tmp13_;
	_tmp14_ = g_settings_get_boolean ((GSettings*) settings, DEJA_DUP_BACKUP_KEY);
	value = _tmp14_;
	_tmp15_ = self->priv->button;
	gtk_switch_set_active (_tmp15_, value);
	_tmp16_ = self->priv->button;
	g_signal_connect_object ((GObject*) _tmp16_, "notify::active", (GCallback) _deja_dup_config_photo_dialog_handle_toggled_g_object_notify, self, 0);
	gtk_dialog_add_button ((GtkDialog*) self, GTK_STOCK_CLOSE, (gint) GTK_RESPONSE_CLOSE);
	_g_object_unref0 (settings);
	_g_object_unref0 (content);
	_g_object_unref0 (hbox);
	_g_object_unref0 (description);
	_g_object_unref0 (label);
}


static void _deja_dup_config_photo_dialog_on_response_gtk_dialog_response (GtkDialog* _sender, gint response_id, gpointer self) {
	deja_dup_config_photo_dialog_on_response (self, _sender, response_id);
}


static void deja_dup_config_photo_dialog_connect_signals (DejaDupConfigPhotoDialog* self) {
	g_return_if_fail (self != NULL);
	g_signal_connect_object ((GtkDialog*) self, "response", (GCallback) _deja_dup_config_photo_dialog_on_response_gtk_dialog_response, self, 0);
}


static void deja_dup_config_photo_dialog_on_response (DejaDupConfigPhotoDialog* self, GtkDialog* source, gint response_id) {
	gint _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (source != NULL);
	_tmp0_ = response_id;
	switch (_tmp0_) {
		case GTK_RESPONSE_CLOSE:
		{
			gtk_widget_destroy ((GtkWidget*) self);
			break;
		}
		default:
		break;
	}
}


static void _vala_array_add5 (const gchar*** array, int* length, int* size, const gchar* value) {
	if ((*length) == (*size)) {
		*size = (*size) ? (2 * (*size)) : 4;
		*array = g_renew (const gchar*, *array, *size);
	}
	(*array)[(*length)++] = value;
}


static void _vala_array_add6 (gchar*** array, int* length, int* size, gchar* value) {
	if ((*length) == (*size)) {
		*size = (*size) ? (2 * (*size)) : 4;
		*array = g_renew (gchar*, *array, (*size) + 1);
	}
	(*array)[(*length)++] = value;
	(*array)[*length] = NULL;
}


static void deja_dup_config_photo_dialog_handle_toggled (DejaDupConfigPhotoDialog* self) {
	DejaDupSimpleSettings* _tmp0_ = NULL;
	DejaDupSimpleSettings* set;
	DejaDupSimpleSettings* _tmp1_;
	GtkSwitch* _tmp2_;
	gboolean _tmp3_ = FALSE;
	GtkSwitch* _tmp4_;
	gboolean _tmp5_ = FALSE;
	DejaDupSimpleSettings* _tmp6_;
	gchar* _tmp7_ = NULL;
	gchar* configpath;
	DejaDupSimpleSettings* _tmp8_ = NULL;
	DejaDupSimpleSettings* settings_app;
	DejaDupSimpleSettings* _tmp9_;
	GVariant* _tmp10_ = NULL;
	GVariant* slist_val;
	GVariant* _tmp11_;
	size_t _tmp12_;
	const gchar** _tmp13_ = NULL;
	const gchar** slist;
	gint slist_length1;
	gint _slist_size_;
	gboolean found;
	const gchar** _tmp14_;
	gint _tmp14__length1;
	GtkSwitch* _tmp21_;
	gboolean _tmp22_ = FALSE;
	g_return_if_fail (self != NULL);
	_tmp0_ = deja_dup_get_settings (DEJA_DUP_APPS_ROOT ".photo-stream");
	set = _tmp0_;
	_tmp1_ = set;
	_tmp2_ = self->priv->button;
	_tmp3_ = gtk_switch_get_active (_tmp2_);
	deja_dup_simple_settings_set_boolean (_tmp1_, DEJA_DUP_BACKUP_KEY, _tmp3_);
	_tmp4_ = self->priv->button;
	_tmp5_ = gtk_switch_get_active (_tmp4_);
	g_signal_emit_by_name (self, "photo-toggled", _tmp5_);
	_tmp6_ = set;
	_tmp7_ = g_settings_get_string ((GSettings*) _tmp6_, "path");
	configpath = _tmp7_;
	_tmp8_ = deja_dup_get_settings (DEJA_DUP_APPS_ROOT);
	settings_app = _tmp8_;
	_tmp9_ = settings_app;
	_tmp10_ = g_settings_get_value ((GSettings*) _tmp9_, DEJA_DUP_APPS_LIST_KEY);
	slist_val = _tmp10_;
	_tmp11_ = slist_val;
	_tmp13_ = g_variant_get_strv (_tmp11_, &_tmp12_);
	slist = _tmp13_;
	slist_length1 = _tmp12_;
	_slist_size_ = slist_length1;
	found = FALSE;
	_tmp14_ = slist;
	_tmp14__length1 = slist_length1;
	{
		const gchar** s_collection = NULL;
		gint s_collection_length1 = 0;
		gint _s_collection_size_ = 0;
		gint s_it = 0;
		s_collection = _tmp14_;
		s_collection_length1 = _tmp14__length1;
		for (s_it = 0; s_it < _tmp14__length1; s_it = s_it + 1) {
			gchar* _tmp15_;
			gchar* s = NULL;
			_tmp15_ = g_strdup ((gchar*) s_collection[s_it]);
			s = _tmp15_;
			{
				gboolean _tmp16_ = FALSE;
				const gchar* _tmp17_;
				gboolean _tmp20_;
				_tmp17_ = s;
				if (_tmp17_ != NULL) {
					const gchar* _tmp18_;
					const gchar* _tmp19_;
					_tmp18_ = s;
					_tmp19_ = configpath;
					_tmp16_ = g_strcmp0 (_tmp18_, _tmp19_) == 0;
				} else {
					_tmp16_ = FALSE;
				}
				_tmp20_ = _tmp16_;
				if (_tmp20_) {
					found = TRUE;
					_g_free0 (s);
					break;
				}
				_g_free0 (s);
			}
		}
	}
	_tmp21_ = self->priv->button;
	_tmp22_ = gtk_switch_get_active (_tmp21_);
	if (_tmp22_) {
		gboolean _tmp23_;
		DejaDupSimpleSettings* _tmp26_;
		const gchar** _tmp27_;
		gint _tmp27__length1;
		GVariant* _tmp28_;
		GVariant* _tmp29_;
		_tmp23_ = found;
		if (!_tmp23_) {
			const gchar** _tmp24_;
			gint _tmp24__length1;
			const gchar* _tmp25_;
			_tmp24_ = slist;
			_tmp24__length1 = slist_length1;
			_tmp25_ = configpath;
			_vala_array_add5 (&slist, &slist_length1, &_slist_size_, _tmp25_);
		}
		_tmp26_ = settings_app;
		_tmp27_ = slist;
		_tmp27__length1 = slist_length1;
		_tmp28_ = g_variant_new_strv (_tmp27_, _tmp27__length1);
		_tmp29_ = g_variant_ref_sink (_tmp28_);
		deja_dup_simple_settings_set_value (_tmp26_, DEJA_DUP_APPS_LIST_KEY, _tmp29_);
		_g_variant_unref0 (_tmp29_);
	} else {
		gchar** _tmp30_ = NULL;
		gchar** paths;
		gint paths_length1;
		gint _paths_size_;
		const gchar** _tmp31_;
		gint _tmp31__length1;
		DejaDupSimpleSettings* _tmp38_;
		gchar** _tmp39_;
		gint _tmp39__length1;
		GVariant* _tmp40_;
		GVariant* _tmp41_;
		_tmp30_ = g_new0 (gchar*, 0 + 1);
		paths = _tmp30_;
		paths_length1 = 0;
		_paths_size_ = paths_length1;
		_tmp31_ = slist;
		_tmp31__length1 = slist_length1;
		{
			const gchar** s_collection = NULL;
			gint s_collection_length1 = 0;
			gint _s_collection_size_ = 0;
			gint s_it = 0;
			s_collection = _tmp31_;
			s_collection_length1 = _tmp31__length1;
			for (s_it = 0; s_it < _tmp31__length1; s_it = s_it + 1) {
				gchar* _tmp32_;
				gchar* s = NULL;
				_tmp32_ = g_strdup ((gchar*) s_collection[s_it]);
				s = _tmp32_;
				{
					const gchar* _tmp33_;
					const gchar* _tmp34_;
					_tmp33_ = s;
					_tmp34_ = configpath;
					if (g_strcmp0 (_tmp33_, _tmp34_) != 0) {
						gchar** _tmp35_;
						gint _tmp35__length1;
						const gchar* _tmp36_;
						gchar* _tmp37_;
						_tmp35_ = paths;
						_tmp35__length1 = paths_length1;
						_tmp36_ = s;
						_tmp37_ = g_strdup (_tmp36_);
						_vala_array_add6 (&paths, &paths_length1, &_paths_size_, _tmp37_);
					}
					_g_free0 (s);
				}
			}
		}
		_tmp38_ = settings_app;
		_tmp39_ = paths;
		_tmp39__length1 = paths_length1;
		_tmp40_ = g_variant_new_strv ((const gchar**) _tmp39_, _tmp39__length1);
		_tmp41_ = g_variant_ref_sink (_tmp40_);
		deja_dup_simple_settings_set_value (_tmp38_, DEJA_DUP_APPS_LIST_KEY, _tmp41_);
		_g_variant_unref0 (_tmp41_);
		paths = (_vala_array_free (paths, paths_length1, (GDestroyNotify) g_free), NULL);
	}
	slist = (g_free (slist), NULL);
	_g_variant_unref0 (slist_val);
	_g_object_unref0 (settings_app);
	_g_free0 (configpath);
	_g_object_unref0 (set);
}


static void deja_dup_config_photo_dialog_class_init (DejaDupConfigPhotoDialogClass * klass) {
	deja_dup_config_photo_dialog_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (DejaDupConfigPhotoDialogPrivate));
	G_OBJECT_CLASS (klass)->finalize = deja_dup_config_photo_dialog_finalize;
	g_signal_new ("photo_toggled", DEJA_DUP_TYPE_CONFIG_PHOTO_DIALOG, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__BOOLEAN, G_TYPE_NONE, 1, G_TYPE_BOOLEAN);
}


static void deja_dup_config_photo_dialog_instance_init (DejaDupConfigPhotoDialog * self) {
	self->priv = DEJA_DUP_CONFIG_PHOTO_DIALOG_GET_PRIVATE (self);
}


static void deja_dup_config_photo_dialog_finalize (GObject* obj) {
	DejaDupConfigPhotoDialog * self;
	self = DEJA_DUP_CONFIG_PHOTO_DIALOG (obj);
	_g_object_unref0 (self->priv->button);
	G_OBJECT_CLASS (deja_dup_config_photo_dialog_parent_class)->finalize (obj);
}


GType deja_dup_config_photo_dialog_get_type (void) {
	static volatile gsize deja_dup_config_photo_dialog_type_id__volatile = 0;
	if (g_once_init_enter (&deja_dup_config_photo_dialog_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (DejaDupConfigPhotoDialogClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) deja_dup_config_photo_dialog_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (DejaDupConfigPhotoDialog), 0, (GInstanceInitFunc) deja_dup_config_photo_dialog_instance_init, NULL };
		GType deja_dup_config_photo_dialog_type_id;
		deja_dup_config_photo_dialog_type_id = g_type_register_static (GTK_TYPE_DIALOG, "DejaDupConfigPhotoDialog", &g_define_type_info, 0);
		g_once_init_leave (&deja_dup_config_photo_dialog_type_id__volatile, deja_dup_config_photo_dialog_type_id);
	}
	return deja_dup_config_photo_dialog_type_id__volatile;
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}



